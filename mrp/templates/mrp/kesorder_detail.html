{% extends 'base.html' %}
{% load crispy_forms_tags %}
{{ form.media }}
{% block content %}
    <table class="table table-sm">
        <thead>
        <tr>
            <th>编号</th>
            <th>件</th>
            <th>数量</th>
            <th>单位</th>
            <th>单价</th>
            <th>金额</th>
            <th>编辑</th>
        </tr>
        </thead>

        <tbody>
        {% for object in object_list %}
            <tr id="block_list_tr">
                <td>{{ object.product }}</td>
                <td>{{ object.piece }}</td>
                <td>{{ object.quantity }}</td>
                <td>{{ object.uom }}</td>
                <td>{{ object.price }}</td>
                <td>{{ object.get_amount }}</td>
                <td>
                    <a href="{% url 'kes_order_delete_raw_item' object.id %}"
                       onclick="return delete_confirm(this)">删除</a>
                </td>
            </tr>
            {% if object.produces.all %}
                {% for produce in object.produces.all %}
                    <tr>
                        <td>{{ produce.thickness }}厚度</td>
                        <td>{{ produce.piece }}</td>
                    </tr>
                {% endfor %}
            {% endif %}
        {% endfor %}
        </tbody>
        <tfoot>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td>{{ object.get_quantity }}</td>
            <td></td>
            <td>{{ object.get_amount }}</td>
            <td></td>
        </tr>
        </tfoot>
    </table>
    <datalist id="product_list">
        {% for product in product_list %}
            <option value="{{ product.weight }}"
                    data-id="{{ product.id }}"
                    data-quantity="{{ product }}">{{ product.name }}</option>
        {% endfor %}
    </datalist>
    {{ form.media.js }}

{% endblock %}
{% block siderbar %}
    <a href="{{ object.get_absolute_url }}" onclick="return delete_confirm(this)">点击</a>
    <button type="button" class="mdui-btn-raised " onclick="return rec(this)">点击</button>
    <div class="btn-group-vertical">
        <a class="mdui-btn" href="">编辑业务资料</a>
        <a class="btn btn-block btn-outline-primary" href="{% url 'kes_order_create_step2' object.id %}">添加一项界石荒料</a>
        <a class="btn btn-block btn-outline-primary" href="{% url 'kes_order_create_step3' object.id %}">添加一项毛板资料</a>
    </div>
{% endblock %}
{% block head %}
    <script>
        function delete_confirm(val) {
            var a = confirm('确定要删除此条项目？');
            if (a == true) {
                {#    var body = $(document.body),#}
                {#        form = $("<form method='post'></form>"),#}
                {#        input;#}
                {#    form.attr({"action": val.href});#}
                {#$.each(args,function(key,value){#}
                {#    input = $("<input type='hidden'>");#}
                {#    input.attr({"name":key});#}
                {#    input.val(value);#}
                {#    form.append(input);#}
                {#{);#}
                {#    form.appendTo(document.body);#}
                {#    form.submit();#}
                {#    document.body.removeChild(form[0]);#}
                location.href = '' + val.href + ''
            }
            else {
                return false
            }
        }</script>
{% endblock %}
<script>
    function getQuantity(product_id) {
        var select = $('#product_list').find('option[data-id="' + product_id + '"]')
        $("input[name='quantity']").val(select.val)
    }

</script>
{% block domready %}
{% endblock %}